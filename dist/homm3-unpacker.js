(function(e){'use strict';var ce=String.fromCharCode;function t(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function a(e,t){return t={exports:{}},e(t,t.exports),t.exports}function n(e){for(var t=e.length;0<=--t;)e[t]=0}function i(e,t,a,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=a,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function d(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function l(e){return 256>e?Ue[e]:Ue[256+(e>>>7)]}function r(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=255&t>>>8}function o(e,t,a){e.bi_valid>16-a?(e.bi_buf|=65535&t<<e.bi_valid,r(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=a-16):(e.bi_buf|=65535&t<<e.bi_valid,e.bi_valid+=a)}function h(e,t,a){o(e,a[2*t],a[2*t+1])}function _(e,t){var a=0;do a|=1&e,e>>>=1,a<<=1;while(0<--t);return a>>>1}function u(e){16===e.bi_valid?(r(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function c(e,t){var a,i,s,d,l,r,o=t.dyn_tree,_=t.max_code,u=t.stat_desc.static_tree,c=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,g=t.stat_desc.extra_base,b=t.stat_desc.max_length,w=0;for(d=0;d<=15;d++)e.bl_count[d]=0;for(o[2*e.heap[e.heap_max]+1]=0,a=e.heap_max+1;573>a;a++)(i=e.heap[a],d=o[2*o[2*i+1]+1]+1,d>b&&(d=b,w++),o[2*i+1]=d,!(i>_))&&(e.bl_count[d]++,l=0,i>=g&&(l=p[i-g]),r=o[2*i],e.opt_len+=r*(d+l),c&&(e.static_len+=r*(u[2*i+1]+l)));if(0!==w){do{for(d=b-1;0===e.bl_count[d];)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[b]--,w-=2}while(0<w);for(d=b;0!==d;d--)for(i=e.bl_count[d];0!==i;)(s=e.heap[--a],!(s>_))&&(o[2*s+1]!==d&&(e.opt_len+=(d-o[2*s+1])*o[2*s],o[2*s+1]=d),i--)}}function p(e,t,a){var i,s,d=Array(16),l=0;for(i=1;i<=15;i++)d[i]=l=l+a[i-1]<<1;for(s=0;s<=t;s++){var r=e[2*s+1];0!==r&&(e[2*s]=_(d[r]++,r))}}function g(){var e,t,a,s,d,l=Array(16);for(a=0,s=0;s<28;s++)for(qe[s]=a,e=0;e<1<<Re[s];e++)Le[a++]=s;for(Le[a-1]=s,d=0,s=0;16>s;s++)for(Ce[s]=d,e=0;e<1<<Ze[s];e++)Ue[d++]=s;for(d>>=7;s<30;s++)for(Ce[s]=d<<7,e=0;e<1<<Ze[s]-7;e++)Ue[256+d++]=s;for(t=0;t<=15;t++)l[t]=0;for(e=0;143>=e;)Ne[2*e+1]=8,e++,l[8]++;for(;255>=e;)Ne[2*e+1]=9,e++,l[9]++;for(;279>=e;)Ne[2*e+1]=7,e++,l[7]++;for(;287>=e;)Ne[2*e+1]=8,e++,l[8]++;for(p(Ne,287,l),e=0;e<30;e++)Ae[2*e+1]=5,Ae[2*e]=_(e,5);Fe=new i(Ne,Re,257,286,15),Oe=new i(Ae,Ze,0,30,15),je=new i([],Te,0,19,7)}function f(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function m(e){8<e.bi_valid?r(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function b(e,t,a,n){m(e),n&&(r(e,a),r(e,~a)),we.arraySet(e.pending_buf,e.window,t,a,e.pending),e.pending+=a}function w(e,t,a,n){var i=2*t,s=2*a;return e[i]<e[s]||e[i]===e[s]&&n[t]<=n[a]}function v(e,t,a){for(var n=e.heap[a],i=a<<1;i<=e.heap_len&&(i<e.heap_len&&w(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!w(t,n,e.heap[i],e.depth));)e.heap[a]=e.heap[i],a=i,i<<=1;e.heap[a]=n}function y(e,t,a){var n,i,s,d,r=0;if(0!==e.last_lit)do n=e.pending_buf[e.d_buf+2*r]<<8|e.pending_buf[e.d_buf+2*r+1],i=e.pending_buf[e.l_buf+r],r++,0===n?h(e,i,t):(s=Le[i],h(e,s+256+1,t),d=Re[s],0!==d&&(i-=qe[s],o(e,i,d)),n--,s=l(n),h(e,s,a),d=Ze[s],0!==d&&(n-=Ce[s],o(e,n,d)));while(r<e.last_lit);h(e,256,t)}function k(e,t){var a,i,s,d=t.dyn_tree,l=t.stat_desc.static_tree,r=t.stat_desc.has_stree,o=t.stat_desc.elems,h=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<o;a++)0===d[2*a]?d[2*a+1]=0:(e.heap[++e.heap_len]=h=a,e.depth[a]=0);for(;2>e.heap_len;)s=e.heap[++e.heap_len]=2>h?++h:0,d[2*s]=1,e.depth[s]=0,e.opt_len--,r&&(e.static_len-=l[2*s+1]);for(t.max_code=h,a=e.heap_len>>1;1<=a;a--)v(e,d,a);s=o;do a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],v(e,d,1),i=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=i,d[2*s]=d[2*a]+d[2*i],e.depth[s]=(e.depth[a]>=e.depth[i]?e.depth[a]:e.depth[i])+1,d[2*a+1]=d[2*i+1]=s,e.heap[1]=s++,v(e,d,1);while(2<=e.heap_len);e.heap[--e.heap_max]=e.heap[1],c(e,t),p(d,h,e.bl_count)}function x(e,t,a){var i,s,d=-1,l=t[1],r=0,o=7,h=4;for(0===l&&(o=138,h=3),t[2*(a+1)+1]=65535,i=0;i<=a;i++){if(s=l,l=t[2*(i+1)+1],++r<o&&s===l)continue;else r<h?e.bl_tree[2*s]+=r:0===s?10>=r?e.bl_tree[34]++:e.bl_tree[36]++:(s!==d&&e.bl_tree[2*s]++,e.bl_tree[32]++);r=0,d=s,0===l?(o=138,h=3):s===l?(o=6,h=3):(o=7,h=4)}}function z(e,t,a){var i,s,d=-1,l=t[1],r=0,_=7,u=4;for(0===l&&(_=138,u=3),i=0;i<=a;i++){if(s=l,l=t[2*(i+1)+1],++r<_&&s===l)continue;else if(r<u)do h(e,s,e.bl_tree);while(0!=--r);else 0===s?10>=r?(h(e,17,e.bl_tree),o(e,r-3,3)):(h(e,18,e.bl_tree),o(e,r-11,7)):(s!==d&&(h(e,s,e.bl_tree),r--),h(e,16,e.bl_tree),o(e,r-3,2));r=0,d=s,0===l?(_=138,u=3):s===l?(_=6,u=3):(_=7,u=4)}}function B(e){var t;for(x(e,e.dyn_ltree,e.l_desc.max_code),x(e,e.dyn_dtree,e.d_desc.max_code),k(e,e.bl_desc),t=18;3<=t&&0===e.bl_tree[2*De[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function S(e,t,a,n){var i;for(o(e,t-257,5),o(e,a-1,5),o(e,n-4,4),i=0;i<n;i++)o(e,e.bl_tree[2*De[i]+1],3);z(e,e.dyn_ltree,t-1),z(e,e.dyn_dtree,a-1)}function E(e){var t,a=4093624447;for(t=0;31>=t;t++,a>>>=1)if(1&a&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}function I(e){He||(g(),He=!0),e.l_desc=new d(e.dyn_ltree,Fe),e.d_desc=new d(e.dyn_dtree,Oe),e.bl_desc=new d(e.bl_tree,je),e.bi_buf=0,e.bi_valid=0,f(e)}function R(e,t,a,n){o(e,0+(n?1:0),3),b(e,t,a,!0)}function Z(e,t){return e.msg=Ye[t],t}function T(e){return(e<<1)-(4<e?9:0)}function D(e){for(var t=e.length;0<=--t;)e[t]=0}function N(e){var t=e.state,a=t.pending;a>e.avail_out&&(a=e.avail_out);0===a||(we.arraySet(e.output,t.pending_buf,t.pending_out,a,e.next_out),e.next_out+=a,t.pending_out+=a,e.total_out+=a,e.avail_out-=a,t.pending-=a,0===t.pending&&(t.pending_out=0))}function A(e,t){Me._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,N(e.strm)}function U(e,t){e.pending_buf[e.pending++]=t}function L(e,t){e.pending_buf[e.pending++]=255&t>>>8,e.pending_buf[e.pending++]=255&t}function C(e,t,a,n){var i=e.avail_in;return(i>n&&(i=n),0===i)?0:(e.avail_in-=i,we.arraySet(t,e.input,e.next_in,i,a),1===e.state.wrap?e.adler=Ge(e.adler,t,i,a):2===e.state.wrap&&(e.adler=Xe(e.adler,t,i,a)),e.next_in+=i,e.total_in+=i,i)}function F(e,t){var a,n,i=e.max_chain_length,s=e.strstart,d=e.prev_length,l=e.nice_match,r=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,o=e.window,h=e.w_mask,_=e.prev,u=e.strstart+258,c=o[s+d-1],p=o[s+d];e.prev_length>=e.good_match&&(i>>=2),l>e.lookahead&&(l=e.lookahead);do{if(a=t,o[a+d]!==p||o[a+d-1]!==c||o[a]!==o[s]||o[++a]!==o[s+1])continue;s+=2,a++;do;while(o[++s]===o[++a]&&o[++s]===o[++a]&&o[++s]===o[++a]&&o[++s]===o[++a]&&o[++s]===o[++a]&&o[++s]===o[++a]&&o[++s]===o[++a]&&o[++s]===o[++a]&&s<u);if(n=258-(u-s),s=u-258,n>d){if(e.match_start=t,d=n,n>=l)break;c=o[s+d-1],p=o[s+d]}}while((t=_[t&h])>r&&0!=--i);return d<=e.lookahead?d:e.lookahead}function O(e){var t,a,i,s,d,l=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=l+(l-262)){we.arraySet(e.window,e.window,l,l,0),e.match_start-=l,e.strstart-=l,e.block_start-=l,a=e.hash_size,t=a;do i=e.head[--t],e.head[t]=i>=l?i-l:0;while(--a);a=l,t=a;do i=e.prev[--t],e.prev[t]=i>=l?i-l:0;while(--a);s+=l}if(0===e.strm.avail_in)break;if(a=C(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=a,3<=e.lookahead+e.insert)for(d=e.strstart-e.insert,e.ins_h=e.window[d],e.ins_h=(e.ins_h<<e.hash_shift^e.window[d+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[d+3-1])&e.hash_mask,e.prev[d&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=d,d++,e.insert--,!(3>e.lookahead+e.insert)););}while(262>e.lookahead&&0!==e.strm.avail_in)}function j(e,t){for(var a,n;;){if(262>e.lookahead){if(O(e),262>e.lookahead&&0===t)return 1;if(0===e.lookahead)break}if(a=0,3<=e.lookahead&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==a&&e.strstart-a<=e.w_size-262&&(e.match_length=F(e,a)),!(3<=e.match_length))n=Me._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;else if(n=Me._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&3<=e.lookahead){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;if(n&&(A(e,!1),0===e.strm.avail_out))return 1}return e.insert=2>e.strstart?e.strstart:2,4===t?(A(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(A(e,!1),0===e.strm.avail_out)?1:2}function P(e,t){for(var a,n,i;;){if(262>e.lookahead){if(O(e),262>e.lookahead&&0===t)return 1;if(0===e.lookahead)break}if(a=0,3<=e.lookahead&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==a&&e.prev_length<e.max_lazy_match&&e.strstart-a<=e.w_size-262&&(e.match_length=F(e,a),5>=e.match_length&&(1===e.strategy||3===e.match_length&&4096<e.strstart-e.match_start)&&(e.match_length=2)),3<=e.prev_length&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=Me._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(A(e,!1),0===e.strm.avail_out))return 1}else if(!e.match_available)e.match_available=1,e.strstart++,e.lookahead--;else if(n=Me._tr_tally(e,0,e.window[e.strstart-1]),n&&A(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}return e.match_available&&(n=Me._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=2>e.strstart?e.strstart:2,4===t?(A(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(A(e,!1),0===e.strm.avail_out)?1:2}function H(e,t){for(var a,n,i,s,d=e.window;;){if(258>=e.lookahead){if(O(e),258>=e.lookahead&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,3<=e.lookahead&&0<e.strstart&&(i=e.strstart-1,n=d[i],n===d[++i]&&n===d[++i]&&n===d[++i])){s=e.strstart+258;do;while(n===d[++i]&&n===d[++i]&&n===d[++i]&&n===d[++i]&&n===d[++i]&&n===d[++i]&&n===d[++i]&&n===d[++i]&&i<s);e.match_length=258-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(3<=e.match_length?(a=Me._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(a=Me._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),a&&(A(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(A(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(A(e,!1),0===e.strm.avail_out)?1:2}function M(e,t){for(var a;;){if(0===e.lookahead&&(O(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,a=Me._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,a&&(A(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(A(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(A(e,!1),0===e.strm.avail_out)?1:2}function G(e,t,a,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=a,this.max_chain=n,this.func=i}function K(e){e.window_size=2*e.w_size,D(e.head),e.max_lazy_match=Pe[e.level].max_lazy,e.good_match=Pe[e.level].good_length,e.nice_match=Pe[e.level].nice_length,e.max_chain_length=Pe[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0}function X(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new we.Buf16(1146),this.dyn_dtree=new we.Buf16(122),this.bl_tree=new we.Buf16(78),D(this.dyn_ltree),D(this.dyn_dtree),D(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new we.Buf16(16),this.heap=new we.Buf16(573),D(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new we.Buf16(573),D(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Y(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,t=e.state,t.pending=0,t.pending_out=0,0>t.wrap&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,Me._tr_init(t),0):Z(e,-2)}function V(e){var t=Y(e);return 0===t&&K(e.state),t}function W(e,t,a,n,i,d){if(!e)return-2;var l=1;if(-1===t&&(t=6),0>n?(l=0,n=-n):15<n&&(l=2,n-=16),1>i||9<i||8!==a||8>n||15<n||0>t||9<t||0>d||4<d)return Z(e,-2);8===n&&(n=9);var r=new X;return e.state=r,r.strm=e,r.wrap=l,r.gzhead=null,r.w_bits=n,r.w_size=1<<r.w_bits,r.w_mask=r.w_size-1,r.hash_bits=i+7,r.hash_size=1<<r.hash_bits,r.hash_mask=r.hash_size-1,r.hash_shift=~~((r.hash_bits+3-1)/3),r.window=new we.Buf8(2*r.w_size),r.head=new we.Buf16(r.hash_size),r.prev=new we.Buf16(r.w_size),r.lit_bufsize=1<<i+6,r.pending_buf_size=4*r.lit_bufsize,r.pending_buf=new we.Buf8(r.pending_buf_size),r.d_buf=1*r.lit_bufsize,r.l_buf=3*r.lit_bufsize,r.level=t,r.strategy=d,r.method=a,V(e)}function $(e,t){var a,n,i,d;if(!e||!e.state||5<t||0>t)return e?Z(e,-2):-2;if(n=e.state,!e.output||!e.input&&0!==e.avail_in||666===n.status&&4!==t)return Z(e,0===e.avail_out?-5:-2);if(n.strm=e,a=n.last_flush,n.last_flush=t,42===n.status)if(2===n.wrap)e.adler=0,U(n,31),U(n,139),U(n,8),n.gzhead?(U(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),U(n,255&n.gzhead.time),U(n,255&n.gzhead.time>>8),U(n,255&n.gzhead.time>>16),U(n,255&n.gzhead.time>>24),U(n,9===n.level?2:2<=n.strategy||2>n.level?4:0),U(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(U(n,255&n.gzhead.extra.length),U(n,255&n.gzhead.extra.length>>8)),n.gzhead.hcrc&&(e.adler=Xe(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(U(n,0),U(n,0),U(n,0),U(n,0),U(n,0),U(n,9===n.level?2:2<=n.strategy||2>n.level?4:0),U(n,3),n.status=113);else{var l=8+(n.w_bits-8<<4)<<8,r=-1;r=2<=n.strategy||2>n.level?0:6>n.level?1:6===n.level?2:3,l|=r<<6,0!==n.strstart&&(l|=32),l+=31-l%31,n.status=113,L(n,l),0!==n.strstart&&(L(n,e.adler>>>16),L(n,65535&e.adler)),e.adler=1}if(69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&!(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=Xe(e.adler,n.pending_buf,n.pending-i,i)),N(e),i=n.pending,n.pending===n.pending_buf_size));)U(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(e.adler=Xe(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=Xe(e.adler,n.pending_buf,n.pending-i,i)),N(e),i=n.pending,n.pending===n.pending_buf_size)){d=1;break}d=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,U(n,d)}while(0!==d);n.gzhead.hcrc&&n.pending>i&&(e.adler=Xe(e.adler,n.pending_buf,n.pending-i,i)),0===d&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=Xe(e.adler,n.pending_buf,n.pending-i,i)),N(e),i=n.pending,n.pending===n.pending_buf_size)){d=1;break}d=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,U(n,d)}while(0!==d);n.gzhead.hcrc&&n.pending>i&&(e.adler=Xe(e.adler,n.pending_buf,n.pending-i,i)),0===d&&(n.status=103)}else n.status=103;if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&N(e),n.pending+2<=n.pending_buf_size&&(U(n,255&e.adler),U(n,255&e.adler>>8),e.adler=0,n.status=113)):n.status=113),0!==n.pending){if(N(e),0===e.avail_out)return n.last_flush=-1,0;}else if(0===e.avail_in&&T(t)<=T(a)&&4!==t)return Z(e,-5);if(666===n.status&&0!==e.avail_in)return Z(e,-5);if(0!==e.avail_in||0!==n.lookahead||0!==t&&666!==n.status){var o=2===n.strategy?M(n,t):3===n.strategy?H(n,t):Pe[n.level].func(n,t);if((3===o||4===o)&&(n.status=666),1===o||3===o)return 0===e.avail_out&&(n.last_flush=-1),0;if(2===o&&(1===t?Me._tr_align(n):5!==t&&(Me._tr_stored_block(n,0,0,!1),3===t&&(D(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),N(e),0===e.avail_out))return n.last_flush=-1,0}return 4===t?0>=n.wrap?1:(2===n.wrap?(U(n,255&e.adler),U(n,255&e.adler>>8),U(n,255&e.adler>>16),U(n,255&e.adler>>24),U(n,255&e.total_in),U(n,255&e.total_in>>8),U(n,255&e.total_in>>16),U(n,255&e.total_in>>24)):(L(n,e.adler>>>16),L(n,65535&e.adler)),N(e),0<n.wrap&&(n.wrap=-n.wrap),0===n.pending?1:0):0}function J(e,t){if(65534>t&&(e.subarray&&$e||!e.subarray&&We))return ce.apply(null,we.shrinkBuf(e,t));for(var a="",n=0;n<t;n++)a+=ce(e[n]);return a}function Q(e){if(!(this instanceof Q))return new Q(e);this.options=we.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&16>t.windowBits&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new et,this.strm.avail_out=0;var a=Ve.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==a)throw new Error(Ye[a]);if(t.header&&Ve.deflateSetHeader(this.strm,t.header),t.dictionary){var n;if(n="string"==typeof t.dictionary?s.string2buf(t.dictionary):"[object ArrayBuffer]"===tt.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,a=Ve.deflateSetDictionary(this.strm,n),0!==a)throw new Error(Ye[a]);this._dict_set=!0}}function ee(e,t){var a=new Q(t);if(a.push(e,!0),a.err)throw a.msg||Ye[a.err];return a.result}function te(e){return(255&e>>>24)+(65280&e>>>8)+((65280&e)<<8)+((255&e)<<24)}function ae(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new we.Buf16(320),this.work=new we.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ne(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new we.Buf32(852),t.distcode=t.distdyn=new we.Buf32(592),t.sane=1,t.back=-1,0):-2}function ie(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,ne(e)):-2}function se(e,t){var a,n;return e&&e.state?(n=e.state,0>t?(a=0,t=-t):(a=(t>>4)+1,48>t&&(t&=15)),t&&(8>t||15<t))?-2:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=a,n.wbits=t,ie(e)):-2}function de(e,t){var a,n;return e?(n=new ae,e.state=n,n.window=null,a=se(e,t),0!==a&&(e.state=null),a):-2}function le(e){if(yt){var t;for(dt=new we.Buf32(512),lt=new we.Buf32(32),t=0;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(vt(1,e.lens,0,288,dt,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;vt(2,e.lens,0,32,lt,0,e.work,{bits:5}),yt=!1}e.lencode=dt,e.lenbits=9,e.distcode=lt,e.distbits=5}function re(e,t,a,n){var i,s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new we.Buf8(s.wsize)),n>=s.wsize?(we.arraySet(s.window,t,a-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>n&&(i=n),we.arraySet(s.window,t,a-n,i,s.wnext),n-=i,n?(we.arraySet(s.window,t,a-n,n,0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0}function oe(e){if(!(this instanceof oe))return new oe(e);this.options=we.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&16>t.windowBits&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),0<=t.windowBits&&16>t.windowBits&&!(e&&e.windowBits)&&(t.windowBits+=32),15<t.windowBits&&48>t.windowBits&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new et,this.strm.avail_out=0;var a=kt.inflateInit2(this.strm,t.windowBits);if(a!==xt.Z_OK)throw new Error(Ye[a]);if(this.header=new zt,kt.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=s.string2buf(t.dictionary):"[object ArrayBuffer]"===Bt.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(a=kt.inflateSetDictionary(this.strm,t.dictionary),a!==xt.Z_OK)))throw new Error(Ye[a])}function he(e,t){var a=new oe(t);if(a.push(e,!0),a.err)throw a.msg||Ye[a.err];return a.result}function _e(e){return e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}function ue(e,{palette:t,legacy:a,selection:n,format:i,padding:s}){const d=e.uint32(),l=e.uint32(),r=e.uint32(),o=e.uint32();let h,_,u,c;a?(h=r,_=o,u=0,c=0):(h=e.uint32(),_=e.uint32(),u=e.uint32(),c=e.uint32());const p=[],g=e.at,f={r:255,g:255,b:0};if(0===l&&p.push(...e.loop(d,e.uint8)),1===l){const t=e.loop(_,e.uint32);for(const a of t){e.seek(g+a);let t=h;do{const a=e.uint8(),n=e.uint8()+1;p.push(...e.loop(n,255===a?e.uint8:a)),t-=n}while(t)}}else if(2===l){const t=e.loop(_,e.uint16);e.skip(2);for(const a of t){e.seek(g+a);let t=h;do{const a=e.uint8(),n=a>>5,i=(31&a)+1;p.push(...e.loop(i,7===n?e.uint8:n)),t-=i}while(t)}}else if(3===l){const t=e.loop(_*h/32,e.uint16);for(const a of t){e.seek(g+a);let t=32;do{const a=e.uint8(),n=a>>5,i=(31&a)+1;p.push(...e.loop(i,7===n?e.uint8:n)),t-=i}while(t)}}const m={width:h,height:_,x:u,y:c};if(s){let e=new ge(4*(r*o));for(let n=0;n<_;n++){e.seek(4*((c+n)*r+u));for(let i=0;i<h;i++){const s=p[n*h+i],{r:d,g:l,b:r,a:o=255}=t[s];e.setuint8(d,l,r,o)}}if(m.data="bitmap"===i?e.buffer:Zt.encode([e.buffer],r,o,0),!n||!p.includes(5))return m;e=new ge(4*(r*o));for(let n=0;n<_;n++){e.seek(4*((c+n)*r+u));for(let i=0;i<h;i++){const s=p[n*h+i],{r:d,g:l,b:r,a:o=255}=5===s||6===s||7===s?f:t[0];e.setuint8(d,l,r,o)}}m.selection="bitmap"===i?e.buffer:Zt.encode([e.buffer],r,o,0)}else{let e=new ge(4*(h*_));for(const n of p){const{r:i,g:s,b:d,a:l=255}=t[n];e.setuint8(i,s,d,l)}if(m.data="bitmap"===i?e.buffer:Zt.encode([e.buffer],h,_,0),!n||!p.includes(5))return m;e=new ge(4*(h*_));for(const n of p){const{r:i,g:s,b:d,a:l=255}=5===n||6===n||7===n?f:t[0];e.setuint8(i,s,d,l)}m.selection="bitmap"===i?e.buffer:Zt.encode([e.buffer],h,_,0)}return m}class pe{constructor(e,t=0,a){if(e.buffer&&({buffer:e}=e),"number"==typeof e&&(e=new ArrayBuffer(e)),!(e instanceof ArrayBuffer))throw new Error("ArrayBuffer/Buffer/DataView expected.");(!a||t+a>e.byteLength)&&(a=e.byteLength-t),this.buffer=e,this.view=new DataView(e,t,a),this.at=0,this.length=a}uint32(){const e=this.view.getUint32(this.at,!0);return this.at+=4,e}uint16(){const e=this.view.getUint16(this.at,!0);return this.at+=2,e}uint8(){return this.view.getUint8(this.at++)}string(e=1){let t="";for(let a=0;a<e;a++)t+=ce(this.view.getUint8(this.at++));return t}skip(e=1){this.at+=e}seek(e){this.at=e}loop(e,t){if("function"!=typeof t)return Array(e).fill(t);const a=[];for(let n=0;n<e;n++)a.push(t.call(this,n));return a}setbuffer(...e){for(const t of e){const e=new pe(t);for(let a=0;a<t.byteLength;a++)this.view.setUint8(this.at++,e.uint8())}}setstring(...e){for(const t of e)for(let e=0;e<t.length;e++)this.view.setUint8(this.at++,t.charCodeAt(e))}setuint8(...e){for(const t of e)this.view.setUint8(this.at++,t)}setuint16(...e){for(const t of e)this.view.setUint16(this.at,t,!0),this.at+=2}setuint32(...e){for(const t of e)this.view.setUint32(this.at,t,!0),this.at+=4}}var ge=pe;const fe={1:"h3m",2:"txt",16:"pcx (indexed)",17:"pcx (bgr)",64:"def (spell)",65:"def (spritedef)",66:"def (creature)",67:"def (adventure object)",68:"def (adventure hero)",69:"def (terrain)",70:"def (cursor)",71:"def (interface)",72:"def (sprite frame)",73:"def (combat hero)",79:"msk",80:"fnt",96:"pal",200:"lod (vanilla)",500:"lod (expansion)"},me={"def (creature)":{0:"moving",1:"mouse over",2:"standing",3:"getting hit",4:"defend",5:"death",6:"???",7:"turn left",8:"turn right",9:"turn left",10:"turn right",11:"attack up",12:"attack straight",13:"attack down",14:"shoot up",15:"shoot straight",16:"shoot down",17:"hex attack up",18:"hex attack straight",19:"hex attack down",20:"start moving",21:"stop moving"},"def (adventure hero)":{0:"turn north",1:"turn northeast",2:"turn east",3:"turn southeast",4:"turn south",5:"move north",6:"move northeast",7:"move east",8:"move southeast",9:"move south"},"def (combat hero)":{0:"standing",1:"standing",2:"failure",3:"success",4:"spellcasting"}};var be={defineFileType:function(e){const t=fe[e];if(!t)throw new Error("Unknown file type.");return t},defineDEFGroup:function(e,t){if(!me[e]){if(0===t)return"all";throw new Error("Unknown animation type.")}const a=me[e][t];if(!a)throw new Error("Unknown animation type.");return a}},we=a(function(e,t){function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)a(n,i)&&(e[i]=n[i])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,a,n,s){if(t.subarray&&e.subarray)return void e.set(t.subarray(a,a+n),s);for(var d=0;d<n;d++)e[s+d]=t[a+d]},flattenChunks:function(e){var t,a,n,s,d,r;for(n=0,t=0,a=e.length;t<a;t++)n+=e[t].length;for(r=new Uint8Array(n),s=0,(t=0,a=e.length);t<a;t++)d=e[t],r.set(d,s),s+=d.length;return r}},s={arraySet:function(e,t,a,n,s){for(var d=0;d<n;d++)e[s+d]=t[a+d]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,i)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,s))},t.setTyped(n)}),ve=we.assign,ye=we.shrinkBuf,ke=we.setTyped,xe=we.Buf8,ze=we.Buf16,Be=we.Buf32,Se=29,Ee=256+1+Se,Ie=30,Re=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Ze=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Te=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],De=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Ne=Array(2*(Ee+2));n(Ne);var Ae=Array(2*Ie);n(Ae);var Ue=Array(512);n(Ue);var Le=Array(258-3+1);n(Le);var qe=Array(Se);n(qe);var Ce=Array(Ie);n(Ce);var Fe,Oe,je,Pe,He=!1,Me={_tr_init:I,_tr_stored_block:R,_tr_flush_block:function(e,t,a,n){var i,s,d=0;0<e.level?(e.strm.data_type===2&&(e.strm.data_type=E(e)),k(e,e.l_desc),k(e,e.d_desc),d=B(e),i=e.opt_len+3+7>>>3,s=e.static_len+3+7>>>3,s<=i&&(i=s)):i=s=a+5,a+4<=i&&-1!==t?R(e,t,a,n):e.strategy===4||s===i?(o(e,2+(n?1:0),3),y(e,Ne,Ae)):(o(e,4+(n?1:0),3),S(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),y(e,e.dyn_ltree,e.dyn_dtree)),f(e),n&&m(e)},_tr_tally:function(e,t,a){return e.pending_buf[e.d_buf+2*e.last_lit]=255&t>>>8,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&a,e.last_lit++,0===t?e.dyn_ltree[2*a]++:(e.matches++,t--,e.dyn_ltree[2*(Le[a]+256+1)]++,e.dyn_dtree[2*l(t)]++),e.last_lit===e.lit_bufsize-1},_tr_align:function(e){o(e,2,3),h(e,256,Ne),u(e)}},Ge=function(e,t,a,i){for(var s=0|65535&e,d=0|65535&e>>>16,l=0;0!==a;){l=2e3<a?2e3:a,a-=l;do s=0|s+t[i++],d=0|d+s;while(--l);s%=65521,d%=65521}return 0|(s|d<<16)},Ke=function(){for(var e,t=[],a=0;256>a;a++){e=a;for(var i=0;8>i;i++)e=1&e?3988292384^e>>>1:e>>>1;t[a]=e}return t}(),Xe=function(e,t,a,n){e^=-1;for(var s=n;s<n+a;s++)e=e>>>8^Ke[255&(e^t[s])];return-1^e},Ye={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};Pe=[new G(0,0,0,0,function(e,t){var a=65535;for(a>e.pending_buf_size-5&&(a=e.pending_buf_size-5);;){if(1>=e.lookahead){if(O(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+a;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,A(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(A(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(A(e,!0),0===e.strm.avail_out?3:4):e.strstart>e.block_start&&(A(e,!1),0===e.strm.avail_out)?1:1}),new G(4,4,8,4,j),new G(4,5,16,8,j),new G(4,6,32,32,j),new G(4,4,16,16,P),new G(8,16,32,32,P),new G(8,16,128,128,P),new G(8,32,128,256,P),new G(32,128,258,1024,P),new G(32,258,258,4096,P)];var Ve={deflateInit:function(e,t){return W(e,t,8,15,8,0)},deflateInit2:W,deflateReset:V,deflateResetKeep:Y,deflateSetHeader:function(e,t){return e&&e.state?2===e.state.wrap?(e.state.gzhead=t,0):-2:-2},deflate:$,deflateEnd:function(e){var t;return e&&e.state?(t=e.state.status,42!==t&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t)?Z(e,-2):(e.state=null,113===t?Z(e,-3):0):-2},deflateSetDictionary:function(e,t){var a,i,d,l,r,o,h,_,u=t.length;if(!e||!e.state)return-2;if(a=e.state,l=a.wrap,2===l||1===l&&42!==a.status||a.lookahead)return-2;for(1===l&&(e.adler=Ge(e.adler,t,u,0)),a.wrap=0,u>=a.w_size&&(0===l&&(D(a.head),a.strstart=0,a.block_start=0,a.insert=0),_=new we.Buf8(a.w_size),we.arraySet(_,t,u-a.w_size,a.w_size,0),t=_,u=a.w_size),r=e.avail_in,o=e.next_in,h=e.input,e.avail_in=u,e.next_in=0,e.input=t,O(a);3<=a.lookahead;){i=a.strstart,d=a.lookahead-2;do a.ins_h=(a.ins_h<<a.hash_shift^a.window[i+3-1])&a.hash_mask,a.prev[i&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=i,i++;while(--d);a.strstart=i,a.lookahead=2,O(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,e.next_in=o,e.input=h,e.avail_in=r,a.wrap=l,0},deflateInfo:"pako deflate (from Nodeca project)"},We=!0,$e=!0;try{ce.apply(null,[0])}catch(e){We=!1}try{ce.apply(null,new Uint8Array(1))}catch(e){$e=!1}for(var Je=new we.Buf8(256),Qe=0;256>Qe;Qe++)Je[Qe]=252<=Qe?6:248<=Qe?5:240<=Qe?4:224<=Qe?3:192<=Qe?2:1;Je[254]=Je[254]=1;var s={string2buf:function(e){var t,a,n,s,d,l=e.length,r=0;for(s=0;s<l;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<l&&(n=e.charCodeAt(s+1),56320==(64512&n)&&(a=65536+(a-55296<<10)+(n-56320),s++)),r+=128>a?1:2048>a?2:65536>a?3:4;for(t=new we.Buf8(r),d=0,s=0;d<r;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<l&&(n=e.charCodeAt(s+1),56320==(64512&n)&&(a=65536+(a-55296<<10)+(n-56320),s++)),128>a?t[d++]=a:2048>a?(t[d++]=192|a>>>6,t[d++]=128|63&a):65536>a?(t[d++]=224|a>>>12,t[d++]=128|63&a>>>6,t[d++]=128|63&a):(t[d++]=240|a>>>18,t[d++]=128|63&a>>>12,t[d++]=128|63&a>>>6,t[d++]=128|63&a);return t},buf2binstring:function(e){return J(e,e.length)},binstring2buf:function(e){for(var t=new we.Buf8(e.length),a=0,n=t.length;a<n;a++)t[a]=e.charCodeAt(a);return t},buf2string:function(e,t){var a,n,s,d,l=t||e.length,r=Array(2*l);for(n=0,a=0;a<l;){if(s=e[a++],128>s){r[n++]=s;continue}if(d=Je[s],4<d){r[n++]=65533,a+=d-1;continue}for(s&=2===d?31:3===d?15:7;1<d&&a<l;)s=s<<6|63&e[a++],d--;if(1<d){r[n++]=65533;continue}65536>s?r[n++]=s:(s-=65536,r[n++]=55296|1023&s>>10,r[n++]=56320|1023&s)}return J(r,n)},utf8border:function(e,t){var a;for(t=t||e.length,t>e.length&&(t=e.length),a=t-1;0<=a&&128==(192&e[a]);)a--;return 0>a?t:0===a?t:a+Je[e[a]]>t?a:t}},et=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},tt=Object.prototype.toString,at=4,nt=0,it=1,st=2;Q.prototype.push=function(e,t){var a,n,i=this.strm,d=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?at:0,i.input="string"==typeof e?s.string2buf(e):"[object ArrayBuffer]"===tt.call(e)?new Uint8Array(e):e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new we.Buf8(d),i.next_out=0,i.avail_out=d),a=Ve.deflate(i,n),a!==it&&a!==nt)return this.onEnd(a),this.ended=!0,!1;(0===i.avail_out||0===i.avail_in&&(n===at||n===st))&&("string"===this.options.to?this.onData(s.buf2binstring(we.shrinkBuf(i.output,i.next_out))):this.onData(we.shrinkBuf(i.output,i.next_out)))}while((0<i.avail_in||0===i.avail_out)&&a!==it);return n===at?(a=Ve.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===nt):n!==st||(this.onEnd(nt),i.avail_out=0,!0)},Q.prototype.onData=function(e){this.chunks.push(e)},Q.prototype.onEnd=function(e){e===nt&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=we.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var dt,lt,rt=30,ot=function(e,t){var a,n,i,s,d,l,r,o,h,_,u,c,p,g,f,m,b,w,v,y,k,x,z,B,S;a=e.state,n=e.next_in,B=e.input,i=n+(e.avail_in-5),s=e.next_out,S=e.output,d=s-(t-e.avail_out),l=s+(e.avail_out-257),r=a.dmax,o=a.wsize,h=a.whave,_=a.wnext,u=a.window,c=a.hold,p=a.bits,g=a.lencode,f=a.distcode,m=(1<<a.lenbits)-1,b=(1<<a.distbits)-1;top:do{15>p&&(c+=B[n++]<<p,p+=8,c+=B[n++]<<p,p+=8),w=g[c&m];dolen:for(;;){if(v=w>>>24,c>>>=v,p-=v,v=255&w>>>16,0===v)S[s++]=65535&w;else if(16&v){y=65535&w,v&=15,v&&(p<v&&(c+=B[n++]<<p,p+=8),y+=c&(1<<v)-1,c>>>=v,p-=v),15>p&&(c+=B[n++]<<p,p+=8,c+=B[n++]<<p,p+=8),w=f[c&b];dodist:for(;;){if(v=w>>>24,c>>>=v,p-=v,v=255&w>>>16,16&v){if(k=65535&w,v&=15,p<v&&(c+=B[n++]<<p,p+=8,p<v&&(c+=B[n++]<<p,p+=8)),k+=c&(1<<v)-1,k>r){e.msg="invalid distance too far back",a.mode=rt;break top}if(c>>>=v,p-=v,v=s-d,k>v){if(v=k-v,v>h&&a.sane){e.msg="invalid distance too far back",a.mode=rt;break top}if(x=0,z=u,0===_){if(x+=o-v,v<y){y-=v;do S[s++]=u[x++];while(--v);x=s-k,z=S}}else if(_<v){if(x+=o+_-v,v-=_,v<y){y-=v;do S[s++]=u[x++];while(--v);if(x=0,_<y){v=_,y-=v;do S[s++]=u[x++];while(--v);x=s-k,z=S}}}else if(x+=_-v,v<y){y-=v;do S[s++]=u[x++];while(--v);x=s-k,z=S}for(;2<y;)S[s++]=z[x++],S[s++]=z[x++],S[s++]=z[x++],y-=3;y&&(S[s++]=z[x++],1<y&&(S[s++]=z[x++]))}else{x=s-k;do S[s++]=S[x++],S[s++]=S[x++],S[s++]=S[x++],y-=3;while(2<y);y&&(S[s++]=S[x++],1<y&&(S[s++]=S[x++]))}}else if(0==(64&v)){w=f[(65535&w)+(c&(1<<v)-1)];continue dodist}else{e.msg="invalid distance code",a.mode=rt;break top}break}}else if(0==(64&v)){w=g[(65535&w)+(c&(1<<v)-1)];continue dolen}else if(32&v){a.mode=12;break top}else{e.msg="invalid literal/length code",a.mode=rt;break top}break}}while(n<i&&s<l);return y=p>>3,n-=y,p-=y<<3,c&=(1<<p)-1,e.next_in=n,e.next_out=s,e.avail_in=n<i?5+(i-n):5-(n-i),e.avail_out=s<l?257+(l-s):257-(s-l),a.hold=c,void(a.bits=p)},ht=15,_t=852,ut=592,ct=0,pt=1,gt=2,ft=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],mt=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],bt=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],wt=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],vt=function(e,t,a,n,i,s,d,l){var r,o,h,_,u,c,p,g,f,m=l.bits,b=0,w=0,v=0,y=0,k=0,x=0,z=0,B=0,S=0,E=0,I=null,R=0,Z=new we.Buf16(ht+1),T=new we.Buf16(ht+1),D=null,N=0;for(b=0;b<=ht;b++)Z[b]=0;for(w=0;w<n;w++)Z[t[a+w]]++;for(k=m,y=ht;1<=y&&0===Z[y];y--);if(k>y&&(k=y),0===y)return i[s++]=20971520,i[s++]=20971520,l.bits=1,0;for(v=1;v<y&&0===Z[v];v++);for(k<v&&(k=v),B=1,b=1;b<=ht;b++)if(B<<=1,B-=Z[b],0>B)return-1;if(0<B&&(e===ct||1!==y))return-1;for(T[1]=0,b=1;b<ht;b++)T[b+1]=T[b]+Z[b];for(w=0;w<n;w++)0!==t[a+w]&&(d[T[t[a+w]]++]=w);if(e===ct?(I=D=d,c=19):e===pt?(I=ft,R-=257,D=mt,N-=257,c=256):(I=bt,D=wt,c=-1),E=0,w=0,b=v,u=s,x=k,z=0,h=-1,S=1<<k,_=S-1,e===pt&&S>_t||e===gt&&S>ut)return 1;for(;;){p=b-z,d[w]<c?(g=0,f=d[w]):d[w]>c?(g=D[N+d[w]],f=I[R+d[w]]):(g=96,f=0),r=1<<b-z,o=1<<x,v=o;do o-=r,i[u+(E>>z)+o]=0|(p<<24|g<<16|f);while(0!==o);for(r=1<<b-1;E&r;)r>>=1;if(0===r?E=0:(E&=r-1,E+=r),w++,0==--Z[b]){if(b===y)break;b=t[a+d[w]]}if(b>k&&(E&_)!==h){for(0===z&&(z=k),u+=v,x=b-z,B=1<<x;x+z<y&&(B-=Z[x+z],!(0>=B));)x++,B<<=1;if(S+=1<<x,e===pt&&S>_t||e===gt&&S>ut)return 1;h=E&_,i[h]=0|(k<<24|x<<16|u-s)}}return 0!==E&&(i[u+E]=0|(4194304|b-z<<24)),l.bits=k,0},yt=!0,kt={inflateReset:ie,inflateReset2:se,inflateResetKeep:ne,inflateInit:function(e){return de(e,15)},inflateInit2:de,inflate:function(e,t){var a,i,s,d,l,r,o,h,_,u,c,p,g,f,m,b,w,v,y,k,x,z,B,S,E=0,I=new we.Buf8(4),R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;a=e.state,12===a.mode&&(a.mode=13),l=e.next_out,s=e.output,o=e.avail_out,d=e.next_in,i=e.input,r=e.avail_in,h=a.hold,_=a.bits,u=r,c=o,z=0;inf_leave:for(;;)switch(a.mode){case 1:if(0===a.wrap){a.mode=13;break}for(;16>_;){if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}if(2&a.wrap&&35615===h){a.check=0,I[0]=255&h,I[1]=255&h>>>8,a.check=Xe(a.check,I,2,0),h=0,_=0,a.mode=2;break}if(a.flags=0,a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",a.mode=30;break}if(8!==(15&h)){e.msg="unknown compression method",a.mode=30;break}if(h>>>=4,_-=4,x=(15&h)+8,0===a.wbits)a.wbits=x;else if(x>a.wbits){e.msg="invalid window size",a.mode=30;break}a.dmax=1<<x,e.adler=a.check=1,a.mode=512&h?10:12,h=0,_=0;break;case 2:for(;16>_;){if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}if(a.flags=h,8!==(255&a.flags)){e.msg="unknown compression method",a.mode=30;break}if(57344&a.flags){e.msg="unknown header flags set",a.mode=30;break}a.head&&(a.head.text=1&h>>8),512&a.flags&&(I[0]=255&h,I[1]=255&h>>>8,a.check=Xe(a.check,I,2,0)),h=0,_=0,a.mode=3;case 3:for(;32>_;){if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}a.head&&(a.head.time=h),512&a.flags&&(I[0]=255&h,I[1]=255&h>>>8,I[2]=255&h>>>16,I[3]=255&h>>>24,a.check=Xe(a.check,I,4,0)),h=0,_=0,a.mode=4;case 4:for(;16>_;){if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}a.head&&(a.head.xflags=255&h,a.head.os=h>>8),512&a.flags&&(I[0]=255&h,I[1]=255&h>>>8,a.check=Xe(a.check,I,2,0)),h=0,_=0,a.mode=5;case 5:if(1024&a.flags){for(;16>_;){if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}a.length=h,a.head&&(a.head.extra_len=h),512&a.flags&&(I[0]=255&h,I[1]=255&h>>>8,a.check=Xe(a.check,I,2,0)),h=0,_=0}else a.head&&(a.head.extra=null);a.mode=6;case 6:if(1024&a.flags&&(p=a.length,p>r&&(p=r),p&&(a.head&&(x=a.head.extra_len-a.length,!a.head.extra&&(a.head.extra=Array(a.head.extra_len)),we.arraySet(a.head.extra,i,d,p,x)),512&a.flags&&(a.check=Xe(a.check,i,p,d)),r-=p,d+=p,a.length-=p),a.length))break inf_leave;a.length=0,a.mode=7;case 7:if(2048&a.flags){if(0===r)break inf_leave;p=0;do x=i[d+p++],a.head&&x&&65536>a.length&&(a.head.name+=ce(x));while(x&&p<r);if(512&a.flags&&(a.check=Xe(a.check,i,p,d)),r-=p,d+=p,x)break inf_leave}else a.head&&(a.head.name=null);a.length=0,a.mode=8;case 8:if(4096&a.flags){if(0===r)break inf_leave;p=0;do x=i[d+p++],a.head&&x&&65536>a.length&&(a.head.comment+=ce(x));while(x&&p<r);if(512&a.flags&&(a.check=Xe(a.check,i,p,d)),r-=p,d+=p,x)break inf_leave}else a.head&&(a.head.comment=null);a.mode=9;case 9:if(512&a.flags){for(;16>_;){if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}if(h!==(65535&a.check)){e.msg="header crc mismatch",a.mode=30;break}h=0,_=0}a.head&&(a.head.hcrc=1&a.flags>>9,a.head.done=!0),e.adler=a.check=0,a.mode=12;break;case 10:for(;32>_;){if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}e.adler=a.check=te(h),h=0,_=0,a.mode=11;case 11:if(0===a.havedict)return e.next_out=l,e.avail_out=o,e.next_in=d,e.avail_in=r,a.hold=h,a.bits=_,2;e.adler=a.check=1,a.mode=12;case 12:if(5===t||6===t)break inf_leave;case 13:if(a.last){h>>>=7&_,_-=7&_,a.mode=27;break}for(;3>_;){if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}switch(a.last=1&h,h>>>=1,_-=1,3&h){case 0:a.mode=14;break;case 1:if(le(a),a.mode=20,6===t){h>>>=2,_-=2;break inf_leave}break;case 2:a.mode=17;break;case 3:e.msg="invalid block type",a.mode=30;}h>>>=2,_-=2;break;case 14:for(h>>>=7&_,_-=7&_;32>_;){if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}if((65535&h)!=(65535^h>>>16)){e.msg="invalid stored block lengths",a.mode=30;break}if(a.length=65535&h,h=0,_=0,a.mode=15,6===t)break inf_leave;case 15:a.mode=16;case 16:if(p=a.length,p){if(p>r&&(p=r),p>o&&(p=o),0===p)break inf_leave;we.arraySet(s,i,d,p,l),r-=p,d+=p,o-=p,l+=p,a.length-=p;break}a.mode=12;break;case 17:for(;14>_;){if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}if(a.nlen=(31&h)+257,h>>>=5,_-=5,a.ndist=(31&h)+1,h>>>=5,_-=5,a.ncode=(15&h)+4,h>>>=4,_-=4,286<a.nlen||30<a.ndist){e.msg="too many length or distance symbols",a.mode=30;break}a.have=0,a.mode=18;case 18:for(;a.have<a.ncode;){for(;3>_;){if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}a.lens[R[a.have++]]=7&h,h>>>=3,_-=3}for(;19>a.have;)a.lens[R[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,B={bits:a.lenbits},z=vt(0,a.lens,0,19,a.lencode,0,a.work,B),a.lenbits=B.bits,z){e.msg="invalid code lengths set",a.mode=30;break}a.have=0,a.mode=19;case 19:for(;a.have<a.nlen+a.ndist;){for(;;){if(E=a.lencode[h&(1<<a.lenbits)-1],m=E>>>24,b=255&E>>>16,w=65535&E,m<=_)break;if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}if(16>w)h>>>=m,_-=m,a.lens[a.have++]=w;else{if(16===w){for(S=m+2;_<S;){if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}if(h>>>=m,_-=m,0===a.have){e.msg="invalid bit length repeat",a.mode=30;break}x=a.lens[a.have-1],p=3+(3&h),h>>>=2,_-=2}else if(17===w){for(S=m+3;_<S;){if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}h>>>=m,_-=m,x=0,p=3+(7&h),h>>>=3,_-=3}else{for(S=m+7;_<S;){if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}h>>>=m,_-=m,x=0,p=11+(127&h),h>>>=7,_-=7}if(a.have+p>a.nlen+a.ndist){e.msg="invalid bit length repeat",a.mode=30;break}for(;p--;)a.lens[a.have++]=x}}if(30===a.mode)break;if(0===a.lens[256]){e.msg="invalid code -- missing end-of-block",a.mode=30;break}if(a.lenbits=9,B={bits:a.lenbits},z=vt(1,a.lens,0,a.nlen,a.lencode,0,a.work,B),a.lenbits=B.bits,z){e.msg="invalid literal/lengths set",a.mode=30;break}if(a.distbits=6,a.distcode=a.distdyn,B={bits:a.distbits},z=vt(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,B),a.distbits=B.bits,z){e.msg="invalid distances set",a.mode=30;break}if(a.mode=20,6===t)break inf_leave;case 20:a.mode=21;case 21:if(6<=r&&258<=o){e.next_out=l,e.avail_out=o,e.next_in=d,e.avail_in=r,a.hold=h,a.bits=_,ot(e,c),l=e.next_out,s=e.output,o=e.avail_out,d=e.next_in,i=e.input,r=e.avail_in,h=a.hold,_=a.bits,12===a.mode&&(a.back=-1);break}for(a.back=0;;){if(E=a.lencode[h&(1<<a.lenbits)-1],m=E>>>24,b=255&E>>>16,w=65535&E,m<=_)break;if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}if(b&&0==(240&b)){for(v=m,y=b,k=w;;){if(E=a.lencode[k+((h&(1<<v+y)-1)>>v)],m=E>>>24,b=255&E>>>16,w=65535&E,v+m<=_)break;if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}h>>>=v,_-=v,a.back+=v}if(h>>>=m,_-=m,a.back+=m,a.length=w,0===b){a.mode=26;break}if(32&b){a.back=-1,a.mode=12;break}if(64&b){e.msg="invalid literal/length code",a.mode=30;break}a.extra=15&b,a.mode=22;case 22:if(a.extra){for(S=a.extra;_<S;){if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}a.length+=h&(1<<a.extra)-1,h>>>=a.extra,_-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=23;case 23:for(;;){if(E=a.distcode[h&(1<<a.distbits)-1],m=E>>>24,b=255&E>>>16,w=65535&E,m<=_)break;if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}if(0==(240&b)){for(v=m,y=b,k=w;;){if(E=a.distcode[k+((h&(1<<v+y)-1)>>v)],m=E>>>24,b=255&E>>>16,w=65535&E,v+m<=_)break;if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}h>>>=v,_-=v,a.back+=v}if(h>>>=m,_-=m,a.back+=m,64&b){e.msg="invalid distance code",a.mode=30;break}a.offset=w,a.extra=15&b,a.mode=24;case 24:if(a.extra){for(S=a.extra;_<S;){if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}a.offset+=h&(1<<a.extra)-1,h>>>=a.extra,_-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){e.msg="invalid distance too far back",a.mode=30;break}a.mode=25;case 25:if(0===o)break inf_leave;if(p=c-o,a.offset>p){if(p=a.offset-p,p>a.whave&&a.sane){e.msg="invalid distance too far back",a.mode=30;break}p>a.wnext?(p-=a.wnext,g=a.wsize-p):g=a.wnext-p,p>a.length&&(p=a.length),f=a.window}else f=s,g=l-a.offset,p=a.length;p>o&&(p=o),o-=p,a.length-=p;do s[l++]=f[g++];while(--p);0===a.length&&(a.mode=21);break;case 26:if(0===o)break inf_leave;s[l++]=a.length,o--,a.mode=21;break;case 27:if(a.wrap){for(;32>_;){if(0===r)break inf_leave;r--,h|=i[d++]<<_,_+=8}if(c-=o,e.total_out+=c,a.total+=c,c&&(e.adler=a.check=a.flags?Xe(a.check,s,c,l-c):Ge(a.check,s,c,l-c)),c=o,(a.flags?h:te(h))!==a.check){e.msg="incorrect data check",a.mode=30;break}h=0,_=0}a.mode=28;case 28:if(a.wrap&&a.flags){for(;32>_;){if(0===r)break inf_leave;r--,h+=i[d++]<<_,_+=8}if(h!==(4294967295&a.total)){e.msg="incorrect length check",a.mode=30;break}h=0,_=0}a.mode=29;case 29:z=1;break inf_leave;case 30:z=-3;break inf_leave;case 31:return-4;case 32:default:return-2;}if(e.next_out=l,e.avail_out=o,e.next_in=d,e.avail_in=r,a.hold=h,a.bits=_,(a.wsize||c!==e.avail_out&&30>a.mode&&(27>a.mode||4!==t))&&re(e,e.output,e.next_out,c-e.avail_out));return u-=e.avail_in,c-=e.avail_out,e.total_in+=u,e.total_out+=c,a.total+=c,a.wrap&&c&&(e.adler=a.check=a.flags?Xe(a.check,s,c,e.next_out-c):Ge(a.check,s,c,e.next_out-c)),e.data_type=a.bits+(a.last?64:0)+(12===a.mode?128:0)+(20===a.mode||15===a.mode?256:0),(0===u&&0===c||4===t)&&0===z&&(z=-5),z},inflateEnd:function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},inflateGetHeader:function(e,t){var a;return e&&e.state?(a=e.state,0==(2&a.wrap))?-2:(a.head=t,t.done=!1,0):-2},inflateSetDictionary:function(e,t){var a,n,i,s=t.length;return e&&e.state?(a=e.state,0!==a.wrap&&11!==a.mode)?-2:11===a.mode&&(n=1,n=Ge(n,t,s,0),n!==a.check)?-3:(i=re(e,t,s,s),i)?(a.mode=31,-4):(a.havedict=1,0):-2},inflateInfo:"pako inflate (from Nodeca project)"},xt={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},zt=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Bt=Object.prototype.toString;oe.prototype.push=function(e,t){var a,n,i,d,l,r=this.strm,o=this.options.chunkSize,h=this.options.dictionary,_=!1;if(this.ended)return!1;n=t===~~t?t:!0===t?xt.Z_FINISH:xt.Z_NO_FLUSH,r.input="string"==typeof e?s.binstring2buf(e):"[object ArrayBuffer]"===Bt.call(e)?new Uint8Array(e):e,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new we.Buf8(o),r.next_out=0,r.avail_out=o),a=kt.inflate(r,xt.Z_NO_FLUSH),a===xt.Z_NEED_DICT&&h&&(a=kt.inflateSetDictionary(this.strm,h)),a===xt.Z_BUF_ERROR&&!0===_&&(a=xt.Z_OK,_=!1),a!==xt.Z_STREAM_END&&a!==xt.Z_OK)return this.onEnd(a),this.ended=!0,!1;r.next_out&&(0===r.avail_out||a===xt.Z_STREAM_END||0===r.avail_in&&(n===xt.Z_FINISH||n===xt.Z_SYNC_FLUSH))&&("string"===this.options.to?(i=s.utf8border(r.output,r.next_out),d=r.next_out-i,l=s.buf2string(r.output,i),r.next_out=d,r.avail_out=o-d,d&&we.arraySet(r.output,r.output,i,d,0),this.onData(l)):this.onData(we.shrinkBuf(r.output,r.next_out))),0===r.avail_in&&0===r.avail_out&&(_=!0)}while((0<r.avail_in||0===r.avail_out)&&a!==xt.Z_STREAM_END);return a===xt.Z_STREAM_END&&(n=xt.Z_FINISH),n===xt.Z_FINISH?(a=kt.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===xt.Z_OK):n!==xt.Z_SYNC_FLUSH||(this.onEnd(xt.Z_OK),r.avail_out=0,!0)},oe.prototype.onData=function(e){this.chunks.push(e)},oe.prototype.onEnd=function(e){e===xt.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=we.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var St=we.assign,Et={};St(Et,{Deflate:Q,deflate:ee,deflateRaw:function(e,t){return t=t||{},t.raw=!0,ee(e,t)},gzip:function(e,t){return t=t||{},t.gzip=!0,ee(e,t)}},{Inflate:oe,inflate:he,inflateRaw:function(e,t){return t=t||{},t.raw=!0,he(e,t)},ungzip:he},xt);var It=Et;const{defineFileType:Rt}=be;var Zt=a(function(e){(function(){var a,n={};e.exports=n,a="function"==typeof t?It:window.pako,function(n,i){var s=Math.abs,d=Math.round,l=Math.ceil;n.toRGBA8=function(e){var t=e.width,a=e.height;if(null==e.tabs.acTL)return[n.toRGBA8.decodeImage(e.data,t,a,e).buffer];var s=[];null==e.frames[0].data&&(e.frames[0].data=e.data);for(var d,l=new Uint8Array(4*(t*a)),r=0;r<e.frames.length;r++){var o=e.frames[r],h=o.rect.x,_=o.rect.y,u=o.rect.width,c=o.rect.height,p=n.toRGBA8.decodeImage(o.data,u,c,e);if(0==r?d=p:0==o.blend?n._copyTile(p,u,c,d,t,a,h,_,0):1==o.blend&&n._copyTile(p,u,c,d,t,a,h,_,1),s.push(d.buffer),d=d.slice(0),0==o.dispose);else if(1==o.dispose)n._copyTile(l,u,c,d,t,a,h,_,0);else if(2==o.dispose){for(var g=r-1;2==e.frames[g].dispose;)g--;d=new Uint8Array(s[g]).slice(0)}}return s},n.toRGBA8.decodeImage=function(e,t,a,s){var d=t*a,r=n.decode._getBPP(s),o=l(t*r/8),h=new Uint8Array(4*d),_=new Uint32Array(h.buffer),u=s.ctype,c=s.depth,g=n._bin.readUshort;if(6==u){var f=d<<2;if(8==c)for(var m=0;m<f;m++)h[m]=e[m];if(16==c)for(var m=0;m<f;m++)h[m]=e[m<<1]}else if(2==u){var b=s.tabs.tRNS,w=-1,v=-1,k=-1;if(b&&(w=b[0],v=b[1],k=b[2]),8==c)for(var m=0;m<d;m++){var x=m<<2,z=3*m;h[x]=e[z],h[x+1]=e[z+1],h[x+2]=e[z+2],h[x+3]=255,-1!=w&&e[z]==w&&e[z+1]==v&&e[z+2]==k&&(h[x+3]=0)}if(16==c)for(var m=0;m<d;m++){var x=m<<2,z=6*m;h[x]=e[z],h[x+1]=e[z+2],h[x+2]=e[z+4],h[x+3]=255,-1!=w&&g(e,z)==w&&g(e,z+2)==v&&g(e,z+4)==k&&(h[x+3]=0)}}else if(3==u){var B=s.tabs.PLTE,p=s.tabs.tRNS,S=p?p.length:0;if(1==c)for(var E=0;E<a;E++)for(var I=E*o,R=E*t,m=0;m<t;m++){var x=R+m<<2,Z=1&e[I+(m>>3)]>>7-((7&m)<<0),T=3*Z;h[x]=B[T],h[x+1]=B[T+1],h[x+2]=B[T+2],h[x+3]=Z<S?p[Z]:255}if(2==c)for(var E=0;E<a;E++)for(var I=E*o,R=E*t,m=0;m<t;m++){var x=R+m<<2,Z=3&e[I+(m>>2)]>>6-((3&m)<<1),T=3*Z;h[x]=B[T],h[x+1]=B[T+1],h[x+2]=B[T+2],h[x+3]=Z<S?p[Z]:255}if(4==c)for(var E=0;E<a;E++)for(var I=E*o,R=E*t,m=0;m<t;m++){var x=R+m<<2,Z=15&e[I+(m>>1)]>>4-((1&m)<<2),T=3*Z;h[x]=B[T],h[x+1]=B[T+1],h[x+2]=B[T+2],h[x+3]=Z<S?p[Z]:255}if(8==c)for(var m=0;m<d;m++){var x=m<<2,Z=e[m],T=3*Z;h[x]=B[T],h[x+1]=B[T+1],h[x+2]=B[T+2],h[x+3]=Z<S?p[Z]:255}}else if(4==u){if(8==c)for(var m=0;m<d;m++){var x=m<<2,D=m<<1,N=e[D];h[x]=N,h[x+1]=N,h[x+2]=N,h[x+3]=e[D+1]}if(16==c)for(var m=0;m<d;m++){var x=m<<2,D=m<<2,N=e[D];h[x]=N,h[x+1]=N,h[x+2]=N,h[x+3]=e[D+2]}}else if(0==u){var w=s.tabs.tRNS?s.tabs.tRNS:-1;if(1==c)for(var m=0;m<d;m++){var N=255*(1&e[m>>3]>>7-(7&m)),A=N==255*w?0:255;_[m]=A<<24|N<<16|N<<8|N}if(2==c)for(var m=0;m<d;m++){var N=85*(3&e[m>>2]>>6-((3&m)<<1)),A=N==85*w?0:255;_[m]=A<<24|N<<16|N<<8|N}if(4==c)for(var m=0;m<d;m++){var N=17*(15&e[m>>1]>>4-((1&m)<<2)),A=N==17*w?0:255;_[m]=A<<24|N<<16|N<<8|N}if(8==c)for(var m=0;m<d;m++){var N=e[m],A=N==w?0:255;_[m]=A<<24|N<<16|N<<8|N}if(16==c)for(var m=0;m<d;m++){var N=e[m<<1],A=g(e,m<<1)==w?0:255;_[m]=A<<24|N<<16|N<<8|N}}return h},n.decode=function(e){for(var t,a=new Uint8Array(e),s=8,l=n._bin,r=l.readUshort,o=l.readUint,h={tabs:{},frames:[]},_=new Uint8Array(a.length),u=0,c=0,p=[137,80,78,71,13,10,26,10],g=0;8>g;g++)if(a[g]!=p[g])throw"The input is not a PNG file!";for(;s<a.length;){var f=l.readUint(a,s);s+=4;var m=l.readASCII(a,s,4);if(s+=4,"IHDR"==m)n.decode._IHDR(a,s,h);else if("IDAT"==m){for(var g=0;g<f;g++)_[u+g]=a[s+g];u+=f}else if("acTL"==m)h.tabs[m]={num_frames:o(a,s),num_plays:o(a,s+4)},t=new Uint8Array(a.length);else if("fcTL"==m){if(0!=c){var b=h.frames[h.frames.length-1];b.data=n.decode._decompress(h,t.slice(0,c),b.rect.width,b.rect.height),c=0}var w={x:o(a,s+12),y:o(a,s+16),width:o(a,s+4),height:o(a,s+8)},v=r(a,s+22);v=r(a,s+20)/(0==v?100:v);var y={rect:w,delay:d(1e3*v),dispose:a[s+24],blend:a[s+25]};h.frames.push(y)}else if("fdAT"==m){for(var g=0;g<f-4;g++)t[c+g]=a[s+g+4];c+=f-4}else if("pHYs"==m)h.tabs[m]=[l.readUint(a,s),l.readUint(a,s+4),a[s+8]];else if("cHRM"==m){h.tabs[m]=[];for(var g=0;8>g;g++)h.tabs[m].push(l.readUint(a,s+4*g))}else if("tEXt"==m){null==h.tabs[m]&&(h.tabs[m]={});var k=l.nextZero(a,s),x=l.readASCII(a,s,k-s),z=l.readASCII(a,k+1,s+f-k-1);h.tabs[m][x]=z}else if("iTXt"==m){null==h.tabs[m]&&(h.tabs[m]={});var k=0,B=s;k=l.nextZero(a,B);var x=l.readASCII(a,B,k-B);B=k+1,B+=2,k=l.nextZero(a,B);l.readASCII(a,B,k-B);B=k+1,k=l.nextZero(a,B);l.readUTF8(a,B,k-B);B=k+1;var z=l.readUTF8(a,B,f-(B-s));h.tabs[m][x]=z}else if("PLTE"==m)h.tabs[m]=l.readBytes(a,s,f);else if("hIST"==m){var S=h.tabs.PLTE.length/3;h.tabs[m]=[];for(var g=0;g<S;g++)h.tabs[m].push(r(a,s+2*g))}else if("tRNS"==m)3==h.ctype?h.tabs[m]=l.readBytes(a,s,f):0==h.ctype?h.tabs[m]=r(a,s):2==h.ctype&&(h.tabs[m]=[r(a,s),r(a,s+2),r(a,s+4)]);else if("gAMA"==m)h.tabs[m]=l.readUint(a,s)/1e5;else if("sRGB"==m)h.tabs[m]=a[s];else if("bKGD"==m)0==h.ctype||4==h.ctype?h.tabs[m]=[r(a,s)]:2==h.ctype||6==h.ctype?h.tabs[m]=[r(a,s),r(a,s+2),r(a,s+4)]:3==h.ctype&&(h.tabs[m]=a[s]);else if("IEND"==m){if(0!=c){var b=h.frames[h.frames.length-1];b.data=n.decode._decompress(h,t.slice(0,c),b.rect.width,b.rect.height),c=0}h.data=n.decode._decompress(h,_,h.width,h.height);break}s+=f;l.readUint(a,s);s+=4}return delete h.compress,delete h.interlace,delete h.filter,h},n.decode._decompress=function(e,t,a,i){return 0==e.compress&&(t=n.decode._inflate(t)),0==e.interlace?t=n.decode._filterZero(t,e,0,a,i):1==e.interlace&&(t=n.decode._readInterlace(t,e)),t},n.decode._inflate=function(e){return i.inflate(e)},n.decode._readInterlace=function(e,t){for(var a=t.width,i=t.height,s=n.decode._getBPP(t),d=s>>3,r=l(a*s/8),o=new Uint8Array(i*r),h=0,_=[0,0,4,0,2,0,1],u=[0,4,0,2,0,1,0],c=[8,8,8,4,4,2,2],p=[8,8,4,4,2,2,1],g=0;7>g;){for(var f=c[g],m=p[g],b=0,w=0,v=_[g];v<i;)v+=f,w++;for(var k=u[g];k<a;)k+=m,b++;var x=l(b*s/8);n.decode._filterZero(e,t,h,b,w);for(var z=0,B=_[g];B<i;){for(var S=u[g],E=h+z*x<<3;S<a;){if(1==s){var I=e[E>>3];I=1&I>>7-(7&E),o[B*r+(S>>3)]|=I<<7-((3&S)<<0)}if(2==s){var I=e[E>>3];I=3&I>>6-(7&E),o[B*r+(S>>2)]|=I<<6-((3&S)<<1)}if(4==s){var I=e[E>>3];I=15&I>>4-(7&E),o[B*r+(S>>1)]|=I<<4-((1&S)<<2)}if(8<=s)for(var R=B*r+S*d,Z=0;Z<d;Z++)o[R+Z]=e[(E>>3)+Z];E+=s,S+=m}z++,B+=f}0!=b*w&&(h+=w*(1+x)),++g}return o},n.decode._getBPP=function(e){var t=[1,null,3,1,2,null,4][e.ctype];return t*e.depth},n.decode._filterZero=function(e,t,a,s,d){var r=n.decode._getBPP(t),o=l(s*r/8),h=n.decode._paeth;r=l(r/8);for(var _=0;_<d;_++){var u=a+_*o,i=u+_+1,c=e[i-1];if(0==c)for(var p=0;p<o;p++)e[u+p]=e[i+p];else if(1==c){for(var p=0;p<r;p++)e[u+p]=e[i+p];for(var p=r;p<o;p++)e[u+p]=255&e[i+p]+e[u+p-r]}else if(0==_){for(var p=0;p<r;p++)e[u+p]=e[i+p];if(2==c)for(var p=r;p<o;p++)e[u+p]=255&e[i+p];if(3==c)for(var p=r;p<o;p++)e[u+p]=255&e[i+p]+(e[u+p-r]>>1);if(4==c)for(var p=r;p<o;p++)e[u+p]=255&e[i+p]+h(e[u+p-r],0,0)}else{if(2==c)for(var p=0;p<o;p++)e[u+p]=255&e[i+p]+e[u+p-o];if(3==c){for(var p=0;p<r;p++)e[u+p]=255&e[i+p]+(e[u+p-o]>>1);for(var p=r;p<o;p++)e[u+p]=255&e[i+p]+(e[u+p-o]+e[u+p-r]>>1)}if(4==c){for(var p=0;p<r;p++)e[u+p]=255&e[i+p]+h(0,e[u+p-o],0);for(var p=r;p<o;p++)e[u+p]=255&e[i+p]+h(e[u+p-r],e[u+p-o],e[u+p-r-o])}}}return e},n.decode._paeth=function(e,t,a){var n=e+t-a,i=s(n-e),d=s(n-t),l=s(n-a);if(i<=d&&i<=l)return e;return d<=l?t:a},n.decode._IHDR=function(e,t,a){var i=n._bin;a.width=i.readUint(e,t),t+=4,a.height=i.readUint(e,t),t+=4,a.depth=e[t],t++,a.ctype=e[t],t++,a.compress=e[t],t++,a.filter=e[t],t++,a.interlace=e[t],t++},n._bin={nextZero:function(e,t){for(;0!=e[t];)t++;return t},readUshort:function(e,t){return e[t]<<8|e[t+1]},writeUshort:function(e,t,a){e[t]=255&a>>8,e[t+1]=255&a},readUint:function(e,t){return e[t]*16777216+(e[t+1]<<16|e[t+2]<<8|e[t+3])},writeUint:function(e,t,a){e[t]=255&a>>24,e[t+1]=255&a>>16,e[t+2]=255&a>>8,e[t+3]=255&a},readASCII:function(e,t,a){for(var n="",d=0;d<a;d++)n+=ce(e[t+d]);return n},writeASCII:function(e,t,a){for(var n=0;n<a.length;n++)e[t+n]=a.charCodeAt(n)},readBytes:function(e,t,a){for(var n=[],s=0;s<a;s++)n.push(e[t+s]);return n},pad:function(e){return 2>e.length?"0"+e:e},readUTF8:function(t,a,d){for(var e,l="",r=0;r<d;r++)l+="%"+n._bin.pad(t[a+r].toString(16));try{e=decodeURIComponent(l)}catch(i){return n._bin.readASCII(t,a,d)}return e}},n._copyTile=function(e,t,a,n,i,s,d,l,r){for(var o=Math.min,_=o(t,i),u=o(a,s),h=0,c=0,p=0;p<u;p++)for(var g=0;g<_;g++)if(0<=d&&0<=l?(h=p*t+g<<2,c=(l+p)*i+d+g<<2):(h=(-l+p)*t-d+g<<2,c=p*i+g<<2),0==r)n[c]=e[h],n[c+1]=e[h+1],n[c+2]=e[h+2],n[c+3]=e[h+3];else if(1==r){var f=e[h+3]*(1/255),m=e[h]*f,b=e[h+1]*f,w=e[h+2]*f,v=n[c+3]*(1/255),k=n[c]*v,z=n[c+1]*v,B=n[c+2]*v,S=1-f,E=f+v*S,I=0==E?0:1/E;n[c+3]=255*E,n[c+0]=(m+k*S)*I,n[c+1]=(b+z*S)*I,n[c+2]=(w+B*S)*I}else if(2==r){var f=e[h+3],m=e[h],b=e[h+1],w=e[h+2],v=n[c+3],k=n[c],z=n[c+1],B=n[c+2];f==v&&m==k&&b==z&&w==B?(n[c]=0,n[c+1]=0,n[c+2]=0,n[c+3]=0):(n[c]=m,n[c+1]=b,n[c+2]=w,n[c+3]=f)}else if(3==r){var f=e[h+3],m=e[h],b=e[h+1],w=e[h+2],v=n[c+3],k=n[c],z=n[c+1],B=n[c+2];if(f==v&&m==k&&b==z&&w==B)continue;if(220>f&&20<v)return!1}return!0},n.encode=function(e,t,a,s,d,l){null==s&&(s=0),null==l&&(l=!1);for(var r=new Uint8Array(e[0].byteLength*e.length+100),o=[137,80,78,71,13,10,26,10],h=0;8>h;h++)r[h]=o[h];var _=8,u=n._bin,p=n.crc.crc,g=u.writeUint,f=u.writeUshort,m=u.writeASCII,b=n.encode.compressPNG(e,t,a,s,l);g(r,_,13),_+=4,m(r,_,"IHDR"),_+=4,g(r,_,t),_+=4,g(r,_,a),_+=4,r[_]=b.depth,_++,r[_]=b.ctype,_++,r[_]=0,_++,r[_]=0,_++,r[_]=0,_++,g(r,_,p(r,_-17,17)),_+=4,g(r,_,1),_+=4,m(r,_,"sRGB"),_+=4,r[_]=1,_++,g(r,_,p(r,_-5,5)),_+=4;var w=1<e.length;if(w&&(g(r,_,8),_+=4,m(r,_,"acTL"),_+=4,g(r,_,e.length),_+=4,g(r,_,0),_+=4,g(r,_,p(r,_-12,12)),_+=4),3==b.ctype){var v=b.plte.length;g(r,_,3*v),_+=4,m(r,_,"PLTE"),_+=4;for(var h=0;h<v;h++){var y=3*h,k=b.plte[h];r[_+y+0]=255&k,r[_+y+1]=255&k>>8,r[_+y+2]=255&k>>16}if(_+=3*v,g(r,_,p(r,_-3*v-4,3*v+4)),_+=4,b.gotAlpha){g(r,_,v),_+=4,m(r,_,"tRNS"),_+=4;for(var h=0;h<v;h++)r[_+h]=255&b.plte[h]>>24;_+=v,g(r,_,p(r,_-v-4,v+4)),_+=4}}for(var c,x=0,z=0;z<b.frames.length;z++){c=b.frames[z],w&&(g(r,_,26),_+=4,m(r,_,"fcTL"),_+=4,g(r,_,x++),_+=4,g(r,_,c.rect.width),_+=4,g(r,_,c.rect.height),_+=4,g(r,_,c.rect.x),_+=4,g(r,_,c.rect.y),_+=4,f(r,_,d[z]),_+=2,f(r,_,1e3),_+=2,r[_]=c.dispose,_++,r[_]=c.blend,_++,g(r,_,p(r,_-30,30)),_+=4);var B=c.cimg,v=B.length;g(r,_,v+(0==z?0:4)),_+=4;var S=_;m(r,_,0==z?"IDAT":"fdAT"),_+=4,0!=z&&(g(r,_,x++),_+=4);for(var h=0;h<v;h++)r[_+h]=B[h];_+=v,g(r,_,p(r,S,_-S)),_+=4}return g(r,_,0),_+=4,m(r,_,"IEND"),_+=4,g(r,_,p(r,_-4,4)),_+=4,r.buffer.slice(0,_)},n.encode.compressPNG=function(e,t,a,s,d){for(var l=n.encode.compress(e,t,a,s,!1,d),r=0;r<e.length;r++){var o=l.frames[r],h=o.rect.width,_=o.rect.height,u=o.bpl,c=o.bpp,p=new Uint8Array(_*u+_);o.cimg=n.encode._filterZero(o.img,_,c,u,p)}return l},n.encode.compress=function(e,t,a,s,d,r){null==r&&(r=!1);for(var o=6,h=8,_=4,u=255,p=0;p<e.length;p++)for(var g=new Uint8Array(e[p]),f=g.length,m=0;m<f;m+=4)u&=g[m+3];var b=255!=u,w={},v=[];if(0!=e.length&&(w[0]=0,v.push(0),0!=s&&s--),0!=s){var k=n.quantize(e,s,d);e=k.bufs;for(var z,m=0;m<k.plte.length;m++)z=k.plte[m].est.rgba,null==w[z]&&(w[z]=v.length,v.push(z))}else for(var p=0;p<e.length;p++)for(var z,B=new Uint32Array(e[p]),f=B.length,m=0;m<f&&(z=B[m],!((m<t||z!=B[m-1]&&z!=B[m-t])&&null==w[z]&&(w[z]=v.length,v.push(z),300<=v.length)));m++);var S=!!b&&d,E=v.length;256>=E&&!1==r&&(h=2>=E?1:4>=E?2:16>=E?4:8,d&&(h=8),b=!0);for(var I=[],p=0;p<e.length;p++){var R=new Uint8Array(e[p]),Z=new Uint32Array(R.buffer),T=0,D=0,N=t,A=a,U=0;if(0!=p&&!S){for(var L=d||1==p||2==I[I.length-2].dispose?1:2,q=0,C=1e9,F=0;F<L;F++){for(var O=new Uint8Array(e[p-1-F]),P=new Uint32Array(e[p-1-F]),H=t,M=a,G=-1,K=-1,X=0;X<a;X++)for(var m,Y=0;Y<t;Y++)m=X*t+Y,Z[m]!=P[m]&&(Y<H&&(H=Y),Y>G&&(G=Y),X<M&&(M=X),X>K&&(K=X));var V=-1==G?1:(G-H+1)*(K-M+1);V<C&&(C=V,q=F,-1==G?(T=D=0,N=A=1):(T=H,D=M,N=G-H+1,A=K-M+1))}var O=new Uint8Array(e[p-1-q]);1==q&&(I[I.length-1].dispose=2);var W=new Uint8Array(4*(N*A)),$=new Uint32Array(W.buffer);n._copyTile(O,t,a,W,N,A,-T,-D,0),n._copyTile(R,t,a,W,N,A,-T,-D,3)?(n._copyTile(R,t,a,W,N,A,-T,-D,2),U=1):(n._copyTile(R,t,a,W,N,A,-T,-D,0),U=0),R=W,Z=new Uint32Array(R.buffer)}var J=4*N;if(256>=E&&!1==r){J=l(h*N/8);for(var W=new Uint8Array(J*A),X=0;X<A;X++){var m=X*J,Q=X*N;if(8==h)for(var Y=0;Y<N;Y++)W[m+Y]=w[Z[Q+Y]];else if(4==h)for(var Y=0;Y<N;Y++)W[m+(Y>>1)]|=w[Z[Q+Y]]<<4-4*(1&Y);else if(2==h)for(var Y=0;Y<N;Y++)W[m+(Y>>2)]|=w[Z[Q+Y]]<<6-2*(3&Y);else if(1==h)for(var Y=0;Y<N;Y++)W[m+(Y>>3)]|=w[Z[Q+Y]]<<7-1*(7&Y)}R=W,o=3,_=1}else if(!1==b&&1==e.length){for(var W=new Uint8Array(3*(N*A)),ee=N*A,m=0;m<ee;m++){var te=3*m,ae=4*m;W[te]=R[ae],W[te+1]=R[ae+1],W[te+2]=R[ae+2]}R=W,o=2,_=3,J=3*N}I.push({rect:{x:T,y:D,width:N,height:A},img:R,bpl:J,bpp:_,blend:U,dispose:S?1:0})}return{ctype:o,depth:h,plte:v,gotAlpha:b,frames:I}},n.encode._filterZero=function(e,a,s,d,l){for(var r=[],o=0;5>o;o++)if(!(5e5<a*d&&(2==o||3==o||4==o))){for(var h=0;h<a;h++)n.encode._filterLine(l,e,h,d,s,o);if(r.push(i.deflate(l)),1==s)break}for(var _,u=1e9,c=0;c<r.length;c++)r[c].length<u&&(_=c,u=r[c].length);return r[_]},n.encode._filterLine=function(e,t,a,s,d,l){var r=a*s,i=r+a,o=n.decode._paeth;if(e[i]=l,i++,0==l)for(var h=0;h<s;h++)e[i+h]=t[r+h];else if(1==l){for(var h=0;h<d;h++)e[i+h]=t[r+h];for(var h=d;h<s;h++)e[i+h]=255&t[r+h]-t[r+h-d]+256}else if(0==a){for(var h=0;h<d;h++)e[i+h]=t[r+h];if(2==l)for(var h=d;h<s;h++)e[i+h]=t[r+h];if(3==l)for(var h=d;h<s;h++)e[i+h]=255&t[r+h]-(t[r+h-d]>>1)+256;if(4==l)for(var h=d;h<s;h++)e[i+h]=255&t[r+h]-o(t[r+h-d],0,0)+256}else{if(2==l)for(var h=0;h<s;h++)e[i+h]=255&t[r+h]+256-t[r+h-s];if(3==l){for(var h=0;h<d;h++)e[i+h]=255&t[r+h]+256-(t[r+h-s]>>1);for(var h=d;h<s;h++)e[i+h]=255&t[r+h]+256-(t[r+h-s]+t[r+h-d]>>1)}if(4==l){for(var h=0;h<d;h++)e[i+h]=255&t[r+h]+256-o(0,t[r+h-s],0);for(var h=d;h<s;h++)e[i+h]=255&t[r+h]+256-o(t[r+h-d],t[r+h-s],t[r+h-d-s])}}},n.crc={table:function(){for(var e,t=new Uint32Array(256),a=0;256>a;a++){e=a;for(var i=0;8>i;i++)1&e?e=3988292384^e>>>1:e>>>=1;t[a]=e}return t}(),update:function(e,t,a,s){for(var d=0;d<s;d++)e=n.crc.table[255&(e^t[a+d])]^e>>>8;return e},crc:function(e,t,a){return 4294967295^n.crc.update(4294967295,e,t,a)}},n.quantize=function(e,t,s){for(var d=[],l=0,o=0;o<e.length;o++)d.push(n.encode.alphaMul(new Uint8Array(e[o]),s)),l+=e[o].byteLength;for(var h=new Uint8Array(l),_=new Uint32Array(h.buffer),u=0,o=0;o<d.length;o++){for(var c=d[o],p=c.length,f=0;f<p;f++)h[u+f]=c[f];u+=p}var m={i0:0,i1:h.length,bst:null,est:null,tdst:0,left:null,right:null};m.bst=n.quantize.stats(h,m.i0,m.i1),m.est=n.quantize.estats(m.bst);for(var w=[m];w.length<t;){for(var v=0,y=0,o=0;o<w.length;o++)w[o].est.L>v&&(v=w[o].est.L,y=o);if(1e-3>v)break;var k=w[y],x=n.quantize.splitPixels(h,_,k.i0,k.i1,k.est.e,k.est.eMq255),z={i0:k.i0,i1:x,bst:null,est:null,tdst:0,left:null,right:null};z.bst=n.quantize.stats(h,z.i0,z.i1),z.est=n.quantize.estats(z.bst);for(var B={i0:x,i1:k.i1,bst:null,est:null,tdst:0,left:null,right:null,bst:{R:[],m:[],N:k.bst.N-z.bst.N}},o=0;16>o;o++)B.bst.R[o]=k.bst.R[o]-z.bst.R[o];for(var o=0;4>o;o++)B.bst.m[o]=k.bst.m[o]-z.bst.m[o];B.est=n.quantize.estats(B.bst),k.left=z,k.right=B,w[y]=z,w.push(B)}w.sort(function(e,t){return t.bst.N-e.bst.N});for(var S=0;S<d.length;S++){for(var E=n.quantize.planeDst,I=new Uint8Array(d[S].buffer),R=new Uint32Array(d[S].buffer),Z=I.length,o=0;o<Z;o+=4){for(var T=I[o]*(1/255),r=I[o+1]*(1/255),g=I[o+2]*(1/255),b=I[o+3]*(1/255),a=m;a.left;)a=0>=E(a.est,T,r,g,b)?a.left:a.right;R[o>>2]=a.est.rgba}d[S]=R.buffer}return{bufs:d,plte:w}},n.quantize.getNearest=function(e,t,i,s,d){if(null==e.left)return e.tdst=n.quantize.dist(e.est.q,t,i,s,d),e;var a=n.quantize.planeDst(e.est,t,i,s,d),l=e.left,r=e.right;0<a&&(l=e.right,r=e.left);var o=n.quantize.getNearest(l,t,i,s,d);if(o.tdst<=a*a)return o;var h=n.quantize.getNearest(r,t,i,s,d);return h.tdst<o.tdst?h:o},n.quantize.planeDst=function(t,n,i,s,d){var a=t.e;return a[0]*n+a[1]*i+a[2]*s+a[3]*d-t.eMq},n.quantize.dist=function(e,t,n,i,s){var a=t-e[0],d=n-e[1],l=i-e[2],r=s-e[3];return a*a+d*d+l*l+r*r},n.quantize.splitPixels=function(a,i,s,d,l,e){var r=n.quantize.vecDot;for(d-=4;s<d;){for(;r(a,s,l)<=e;)s+=4;for(;r(a,d,l)>e;)d-=4;if(s>=d)break;var o=i[s>>2];i[s>>2]=i[d>>2],i[d>>2]=o,s+=4,d-=4}for(;r(a,s,l)>e;)s-=4;return s+4},n.quantize.vecDot=function(t,a,n){return t[a]*n[0]+t[a+1]*n[1]+t[a+2]*n[2]+t[a+3]*n[3]},n.quantize.stats=function(e,t,n){for(var s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d=[0,0,0,0],l=n-t>>2,o=t;o<n;o+=4){var h=e[o]*(1/255),r=e[o+1]*(1/255),_=e[o+2]*(1/255),u=e[o+3]*(1/255);d[0]+=h,d[1]+=r,d[2]+=_,d[3]+=u,s[0]+=h*h,s[1]+=h*r,s[2]+=h*_,s[3]+=h*u,s[5]+=r*r,s[6]+=r*_,s[7]+=r*u,s[10]+=_*_,s[11]+=_*u,s[15]+=u*u}return s[4]=s[1],s[8]=s[2],s[12]=s[3],s[9]=s[6],s[13]=s[7],s[14]=s[11],{R:s,m:d,N:l}},n.quantize.estats=function(e){var t=Math.sqrt,a=e.R,l=e.m,r=e.N,o=l[0],h=l[1],_=l[2],u=l[3],c=0==r?0:1/r,p=[a[0]-o*o*c,a[1]-o*h*c,a[2]-o*_*c,a[3]-o*u*c,a[4]-h*o*c,a[5]-h*h*c,a[6]-h*_*c,a[7]-h*u*c,a[8]-_*o*c,a[9]-_*h*c,a[10]-_*_*c,a[11]-_*u*c,a[12]-u*o*c,a[13]-u*h*c,a[14]-u*_*c,a[15]-u*u*c],g=n.M4,f=[.5,.5,.5,.5],m=0,w=0;if(0!=r)for(var v=0;10>v&&(f=g.multVec(p,f),w=t(g.dot(f,f)),f=g.sml(1/w,f),!(1e-9>s(w-m)));v++)m=w;var y=[o*c,h*c,_*c,u*c],k=g.dot(g.sml(255,y),f),x=.001>y[3]?0:1/y[3];return{Cov:p,q:y,e:f,L:m,eMq255:k,eMq:g.dot(f,y),rgba:(d(255*y[3])<<24|d(255*y[2]*x)<<16|d(255*y[1]*x)<<8|d(255*y[0]*x)<<0)>>>0}},n.M4={multVec:function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3]]},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},sml:function(e,t){return[e*t[0],e*t[1],e*t[2],e*t[3]]}},n.encode.alphaMul=function(e,t){for(var n=new Uint8Array(e.length),s=e.length>>2,d=0;d<s;d++){var l=d<<2,r=e[l+3];t&&(r=128>r?0:255);var o=r*(1/255);n[l+0]=e[l+0]*o,n[l+1]=e[l+1]*o,n[l+2]=e[l+2]*o,n[l+3]=r}return n}}(n,a)})()});const{defineFileType:Tt}=be,{defineDEFGroup:Dt}=be;const{defineFileType:Nt}=be;var At={unpackLOD:function(e,t=e=>e){function a(){l=!1}if(e instanceof ge||(e=new ge(e)),"object"==typeof t){const e=Object.keys(t);if(!e.every(e=>"function"==typeof t[e]))throw new Error("Invalid processor given.");const a=e.map(e=>({regex:new RegExp(`.${_e(e)}$`,"i"),processor:t[e]}));t=function(e,t,n){for(const i of a)if(i.regex.test(t))return i.processor(e,t,n);return e}}if("function"!=typeof t)throw new Error("Invalid processor given.");const n=e.uint32();if(4476748!==n)throw new Error("Not a LOD file.");const i=Rt(e.uint32()),s=e.uint32();if(1e4<s)throw new Error("File limit exceeded.");e.skip(80);const d={};let l;for(let n=0;n<s;n++){const n=e.string(16).replace(/\0.*$/,""),i=e.uint32(),s=e.uint32();e.uint32();const r=e.uint32();let o;o=0===r?e.buffer.slice(i,i+s):It.inflate(new Uint8Array(e.buffer,i,r)).buffer,l=!0;const h=t(o,n,a);l&&(d[n]=h)}return{type:i,files:d}},unpackDEF:function(e,t={}){if(e instanceof ge||(e=new ge(e)),void 0===t.format&&(t.format="png"),void 0===t.padding&&(t.padding=!1),void 0===t.palette&&(t.palette=e=>e),"png"!==t.format&&"bitmap"!==t.format)throw new Error("DEF output format not supported.");if(!0!==t.padding&&!1!==t.padding)throw new Error("Padding must be a boolean.");if("function"!=typeof t.palette)throw new Error("Palette must be a function.");const a=Tt(e.uint32()),n=e.uint32(),i=e.uint32(),s=e.uint32();let d=e.loop(256,()=>({r:e.uint8(),g:e.uint8(),b:e.uint8(),a:255}));d[0]={r:0,g:0,b:0,a:0},d[1]={r:0,g:0,b:0,a:64},d[4]={r:0,g:0,b:0,a:128},d[5]={r:0,g:0,b:0,a:0},d[6]={r:0,g:0,b:0,a:128},d[7]={r:0,g:0,b:0,a:64},d=t.palette(d),t.palette=d;const l={},r={};for(let n=0;n<s;n++){const n=Dt(a,e.uint32());t.selection="mouse over"===n||"standing"===n;const i=e.uint32();e.skip(8);const s=e.loop(i,()=>e.string(13).replace(/\0.*$/,"")),d=e.loop(i,e.uint32),{at:o}=e,h=d.map(t=>(e.seek(t),e.uint32()+32));e.seek(o),t.legacy=h.some((t,a)=>t+d[a]>e.length),l[n]=e.loop(i,a=>{const n=s[a],i=d[a],l=h[a];return r[n]||(r[n]=ue(new ge(e,i,l),t)),n})}return{type:a,fullWidth:n,fullHeight:i,palette:d,groups:l,images:r}},unpackPCX:function(e,{format:t="png"}={}){if(e instanceof ge||(e=new ge(e)),"png"!==t&&"bitmap"!==t)throw new Error("PCX output format not supported.");let a;const n=e.uint32(),i=e.uint32(),s=e.uint32(),d=i*s,l=new ge(4*d);if(d===n){a=Nt(16);const t=e.loop(d,e.uint8),n=e.loop(256,()=>({r:e.uint8(),g:e.uint8(),b:e.uint8()}));n[0]={r:0,g:0,b:0,a:0};for(const e of t){const{r:t,g:i,b:s,a:d=255}=n[e];l.setuint8(t,i,s,d)}}else if(3*d===n){a=Nt(17);for(let t=0;t<d;t++){const t=e.uint8(),a=e.uint8(),n=e.uint8();l.setuint8(n,a,t,255)}}else throw new Error("Image size mismatch.");const r="bitmap"===t?l.buffer:Zt.encode([l.buffer],i,s,0);return{type:a,width:i,height:s,data:r}}},Ut=At.unpackLOD,Lt=At.unpackDEF,qt=At.unpackPCX;e.default=At,e.unpackLOD=Ut,e.unpackDEF=Lt,e.unpackPCX=qt})(this["homm3-unpacker"]=this["homm3-unpacker"]||{});
